# 4d-tips-network-analysis

単位テストおよびリクエストログ解析の実装例

バージョン: v14

## 準備

``SAMPLE.4dbase``の``Components``フォルダーにある``UNIT.4dbase``を違う場所に退避します。（このコンポーネントがインストールされていると，自動テストが実行されるように設定されています。）

``SAMPLE.4dbase``を開きます。ローカル・リモートどちらのモードでも構いません。

データファイルは空です。``TEST_サンプルデータ作成``メソッドを実行し，サンプルデータを作成します。デフォルトでは100,000件のランダムなレコードが作成されます。

``On Startup``メソッド（``UNIT.4dbase``コンポーネントがインストールされている場合は``00_TEST``）を実行してみてください。集計画面が表示されます。「集計 1」から「集計 3」は，それぞれ同じ内容を集計を実行しますが，メソッドの書き方が違います。「集計 1」は古典的な4Dコーディングです。「集計 3」は，ネットワークトラフィックを意識した書き方になっています。

<img width="662" alt="2017-08-10 17 26 56" src="https://user-images.githubusercontent.com/10509075/29161490-635111f0-7df1-11e7-99f7-4318b4b277c1.png">

マシンのスペックにも左右されますが，それぞれ``30``秒ほどで完了するような集計となっています。ローカルホスト上のクライアント/サーバーでは，どのテストもあまり速度に違いが認められないかもしれません。

<img width="662" alt="2017-08-10 17 56 55" src="https://user-images.githubusercontent.com/10509075/29162771-5a8c7e52-7df5-11e7-923f-953f1cc5c3d6.png">

``SAMPLE.4dbase``を閉じ，``UNIT.4dbase``コンポーネントをインストールしてから，クライアント/サーバーでアプリケーションを開き直します。コンポーネントがインストールされている場合は，自動テスト実行の画面が表示されます。

<img width="717" alt="2017-08-10 17 59 03" src="https://user-images.githubusercontent.com/10509075/29162859-a1471eec-7df5-11e7-9fad-28de42ec3ffd.png">

やはり，ローカルではあまり速度に差がないかもしれません。

<img width="717" alt="2017-08-10 17 59 44" src="https://user-images.githubusercontent.com/10509075/29162910-baeb575a-7df5-11e7-9e1f-3acf87362021.png">

テストが完了すると，リクエストログの場所がFinder/Explorerで表示されます。

リクエストログを表計算ソフトやテキストエディターなどで開きます。

[サンプルリクエストログ](https://github.com/4D-JP/4d-tips-network-analysis/blob/master/4DRequestsLog_1_1.xlsx)

#begin:UNIT_集計_1/#end:UNIT_集計_1などの文字列を目印に，それぞれの単位テストに要したリクエスト数（行数）・入出力バイト数・所要時間を確認します。

### 行数

* テスト#1: 1228-5=1223
* テスト#2: 1470-1229=241
* テスト#3: 1576-1471=105

* Outバイト数合計

* テスト#1: 3,048,505
* テスト#2: 210,116
* テスト#3: 8,534

* Inバイト合計

* テスト#1: 91,705
* テスト#2: 10,832
* テスト#3: 6,979

